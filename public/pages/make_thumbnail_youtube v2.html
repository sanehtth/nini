<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√≥m Ng√†n Chuy·ªán Studio - DNA Version</title>
    <link rel="stylesheet" href="/public/style.css">
    <link rel="stylesheet" href="/public/green-theme.css">
    
    <style>
        /* =================================================================
           CSS RI√äNG CHO TRANG TOOL (GHI ƒê√à ƒê·ªÇ KH·ªöP STYLE ADMIN PANEL)
           DNA Colors: Green #8CCB7A | Brown #B9885D | Yellow #F4E8A2
           ================================================================= */
        
        /* 1. N·ªÄN & KHUNG BAO (Gi·ªëng Admin Panel) */
        body {
            background: linear-gradient(135deg, #CDECC1 0%, #F4E8A2 100%); /* Gradient Xanh -> V√†ng */
            font-family: 'Segoe UI', sans-serif;
            color: #5D4037; /* Ch·ªØ m√†u n√¢u ƒë·∫•t */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .studio-card {
            background: rgba(255, 255, 255, 0.95);
            width: 100%;
            max-width: 1000px;
            border-radius: 30px; /* Bo g√≥c c·ª±c l·ªõn nh∆∞ Admin */
            box-shadow: 0 20px 50px rgba(139, 94, 60, 0.15); /* B√≥ng m√†u n√¢u nh·∫π */
            overflow: hidden;
            border: 4px solid #fff;
        }

        /* 2. HEADER (M√†u Xanh DNA #8CCB7A) */
        .studio-header {
            background: #8CCB7A;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .header-title h2 { margin: 0; font-size: 22px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .header-title p { margin: 5px 0 0; font-size: 13px; opacity: 0.9; color: #F4E8A2; }

        .admin-badge {
            background: #B9885D; /* N√¢u */
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* 3. LAYOUT N·ªòI DUNG */
        .studio-body {
            padding: 30px;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr; /* Chia c·ªôt: Input to h∆°n, K·∫øt qu·∫£ nh·ªè h∆°n */
            gap: 40px;
        }

        /* 4. INPUT STYLES (M·ªÅm m·∫°i) */
        .input-group { margin-bottom: 20px; }
        .label-dna {
            display: block;
            color: #8CCB7A;
            font-weight: 800;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
        }

        .input-dna {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #E0E0E0;
            border-radius: 15px; /* Bo tr√≤n input */
            background: #FAFAFA;
            font-size: 14px;
            transition: 0.3s;
            color: #5D4037;
        }

        .input-dna:focus {
            border-color: #8CCB7A;
            background: #fff;
            outline: none;
            box-shadow: 0 0 0 4px #CDECC1;
        }

        /* 5. CHARACTER ROW */
        .char-row-dna {
            background: #F1F8E9;
            border: 1px dashed #8CCB7A;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* 6. BUTTONS (Style Vi√™n thu·ªëc - Pill Shape) */
        .btn-dna-primary {
            background: #B9885D; /* M√†u N√¢u ch·ªß ƒë·∫°o */
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 50px; /* Pill shape */
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 6px 0 #8D6E63; /* Hi·ªáu ·ª©ng 3D */
            transition: transform 0.1s;
            text-transform: uppercase;
        }

        .btn-dna-primary:hover {
            transform: translateY(2px);
            box-shadow: 0 4px 0 #8D6E63;
            background: #A1887F;
        }

        .btn-dna-secondary {
            background: white;
            border: 2px solid #8CCB7A;
            color: #8CCB7A;
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            font-size: 13px;
        }
        .btn-dna-secondary:hover { background: #F1F8E9; }

        .btn-remove-dna {
            background: #ef9a9a; color: #c62828;
            width: 30px; height: 30px; border-radius: 50%; border: none; font-weight: bold; cursor: pointer;
        }

        /* 7. RESULT BOX (Gi·ªëng b·∫£ng ƒëen ho·∫∑c gi·∫•y c≈©) */
        .result-box-dna {
            background: #FFFDE7; /* Gi·∫•y v√†ng c≈© */
            border: 2px dashed #F4E8A2;
            border-radius: 20px;
            padding: 20px;
            height: fit-content;
        }
        
        .prompt-display {
            background: #3E2723; /* N√¢u ƒëen (nh∆∞ b·∫£ng g·ªó) */
            color: #C8F3E0; /* Ch·ªØ ph·∫•n xanh */
            padding: 20px;
            border-radius: 15px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
            min-height: 200px;
            white-space: pre-wrap;
            position: relative;
        }

        .copy-tag {
            position: absolute; top: -10px; right: -10px;
            background: #8CCB7A; color: white; padding: 5px 15px;
            border-radius: 20px; font-size: 12px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .studio-body { grid-template-columns: 1fr; }
            .studio-card { border-radius: 15px; margin: 10px; width: auto; }
        }
    </style>
</head>
<body>

<div class="studio-card">
    <div class="studio-header">
        <div class="header-title">
            <h2>üé¨ X√≥m Ng√†n Chuy·ªán Studio</h2>
            <p>Tr√¨nh t·∫°o Prompt chu·∫©n Asset & DNA Brand</p>
        </div>
        <div class="admin-badge">Admin Mode</div>
    </div>

    <div id="statusBar" style="background:#C8F3E0; color:#2E7D32; padding:10px; text-align:center; font-size:13px; display:none;">
        üîÑ ƒêang k·∫øt n·ªëi d·ªØ li·ªáu...
    </div>

    <div class="studio-body">
        
        <div class="form-section">
            
            <div class="input-group">
                <label class="label-dna">1. Ch·ªçn B·ªëi C·∫£nh (Background)</label>
                <select id="bgSelect" class="input-dna">
                    <option>-- ƒêang t·∫£i d·ªØ li·ªáu --</option>
                </select>
                <input type="text" id="customBg" class="input-dna" style="margin-top:10px" placeholder="Ho·∫∑c nh·∫≠p b·ªëi c·∫£nh t√πy ch·ªânh...">
            </div>

            <div class="input-group">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <label class="label-dna" style="margin:0">2. ƒê·ªôi H√¨nh Nh√¢n V·∫≠t</label>
                    <button class="btn-dna-secondary" onclick="addChar()">+ Th√™m</button>
                </div>
                <div id="charList"></div>
            </div>

            <div class="input-group">
                <label class="label-dna">3. H√†nh ƒê·ªông / C·ªët Truy·ªán</label>
                <textarea id="actionInput" class="input-dna" rows="3" placeholder="V√≠ d·ª•: T√πmLa ƒëang l√©n ƒÉn c√° n∆∞·ªõng, m·∫∑t l·∫•m l√©t..."></textarea>
            </div>

            <div class="input-group">
                <label class="label-dna">4. C·∫•u H√¨nh ·∫¢nh</label>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <select id="styleSelect" class="input-dna">
                        <option value="video">üé¨ Video H√†i (S√°ng/Vui)</option>
                        <option value="podcast">üéôÔ∏è Podcast (T·ªëi/Ma m·ªã)</option>
                    </select>
                    <select id="ratioSelect" class="input-dna">
                        <option value="--ar 16:9">YouTube (16:9)</option>
                        <option value="--ar 9:16">Shorts (9:16)</option>
                        <option value="--ar 1:1">Vu√¥ng (1:1)</option>
                    </select>
                </div>
            </div>

            <button class="btn-dna-primary" onclick="generate()">‚ö° T·∫†O PROMPT NGAY</button>
        </div>

        <div class="result-section">
            <div class="result-box-dna">
                <label class="label-dna">K·∫øt Qu·∫£ Prompt</label>
                <div class="prompt-display">
                    <div id="finalPrompt">(K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y...)</div>
                    <button class="copy-tag" onclick="copyPrompt()">üìã COPY</button>
                </div>
                <div style="margin-top:15px; font-size:13px; color:#5D4037;">
                    <strong>üí° Tips:</strong>
                    <ul style="padding-left:20px; margin-top:5px;">
                        <li>Prompt ƒë√£ t√≠ch h·ª£p s·∫µn m√£ m√†u DNA (#8CCB7A, #B9885D).</li>
                        <li>Ch·ªçn Podcast ƒë·ªÉ c√≥ √°nh s√°ng ƒë√™m "Ma m·ªã nh∆∞ng ·∫•m c√∫ng".</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // C·∫§U H√åNH ƒê∆Ø·ªúNG D·∫™N (GI·ªÆ NGUY√äN)
    const DATA_PATH = "public/adn/xomnganchuyen/"; 
    const BG_URL = DATA_PATH + "XNC_backgrounds.json";
    const CHAR_URL = DATA_PATH + "XNC_characters.json";

    let bgData = [], charData = [];

    window.onload = async () => {
        const status = document.getElementById('statusBar');
        status.style.display = 'block';
        try {
            const [bgRes, charRes] = await Promise.all([fetch(BG_URL), fetch(CHAR_URL)]);
            if(!bgRes.ok || !charRes.ok) throw new Error("L·ªói ƒë·ªçc file JSON");
            bgData = (await bgRes.json()).backgrounds || [];
            charData = (await charRes.json()).characters || [];
            populateBg(); addChar();
            status.style.display = 'none';
        } catch (e) {
            status.innerHTML = `‚ö†Ô∏è L·ªói k·∫øt n·ªëi: ${e.message}`;
            status.style.background = "#FFCDD2"; status.style.color = "#C62828";
        }
    };

    function populateBg() {
        const sel = document.getElementById('bgSelect');
        sel.innerHTML = '<option value="">-- Ch·ªçn b·ªëi c·∫£nh --</option>';
        bgData.forEach(bg => {
            const opt = document.createElement('option');
            opt.value = bg.id;
            opt.dataset.desc = bg.prompt || bg.desc_en || bg.desc || ""; 
            opt.text = bg.label || bg.name || bg.id;
            sel.appendChild(opt);
        });
    }

    function addChar() {
        const div = document.createElement('div');
        div.className = 'char-row-dna';
        let opts = `<option value="">-- Ch·ªçn nh√¢n v·∫≠t --</option>`;
        charData.forEach(c => {
            let desc = c.prompt || c.base_desc_en || c.desc_en || (c.appearance + " " + c.outfit);
            desc = desc ? desc.replace(/"/g, '&quot;') : "";
            opts += `<option value="${c.id}" data-desc="${desc}">${c.name}</option>`;
        });
        div.innerHTML = `
            <select class="input-dna char-sel" style="border:none; background:transparent;">${opts}</select>
            <input type="text" class="input-dna char-act" style="border:none; background:white; width:40%;" placeholder="H√†nh ƒë·ªông...">
            <button class="btn-remove-dna" onclick="this.parentElement.remove()">√ó</button>
        `;
        document.getElementById('charList').appendChild(div);
    }

    function generate() {
        const bgSel = document.getElementById('bgSelect');
        const customBg = document.getElementById('customBg').value;
        const bgDesc = customBg || bgSel.options[bgSel.selectedIndex]?.dataset.desc || "";
        if(!bgDesc) { alert("Ch∆∞a ch·ªçn b·ªëi c·∫£nh!"); return; }

        let chars = [];
        document.querySelectorAll('.char-row-dna').forEach(row => {
            const sel = row.querySelector('.char-sel');
            const act = row.querySelector('.char-act').value;
            if(sel.value) {
                const name = sel.options[sel.selectedIndex].text;
                const desc = sel.options[sel.selectedIndex].dataset.desc;
                chars.push(`CHARACTER (${name}): ${desc}. ACTION: ${act || "standing"}`);
            }
        });

        const action = document.getElementById('actionInput').value;
        const style = document.getElementById('styleSelect').value;
        const ratio = document.getElementById('ratioSelect').value;

        // DNA PALETTE C·ªê ƒê·ªäNH
        const brandDNA = "**BRAND PALETTE:** Primary Green (#8CCB7A), Earthy Brown (#B9885D), Accent Yellow (#F4E8A2). Soft Pastel Tones (#CDECC1, #D8BFA8).";
        
        let moodSettings = "";
        if (style === 'podcast') {
            moodSettings = `**MOOD & ATMOSPHERE:** Mysterious, Spooky but cozy, Storytelling vibe.\n**LIGHTING & COLOR:** Dim lighting, Vignette effect. Dark Night Blue atmosphere mixed with Warm Brown (#B9885D) shadows and soft Yellow (#F4E8A2) highlights.`;
        } else {
            moodSettings = `**MOOD & ATMOSPHERE:** Bright, Energetic, Funny, High Contrast, Cartoon motion lines.\n**LIGHTING & COLOR:** Sunny daylight. Dominant Fresh Green (#8CCB7A) and bright Sunny Yellow (#F4E8A2).`;
        }

        const final = `
(YouTube Thumbnail), 2D animation style, Vietnamese countryside aesthetic, pastel chibi art.
${brandDNA}

**BACKGROUND:** ${bgDesc}
**CHARACTERS:**
${chars.join("\n")}
**SCENE EVENT:** ${action}

${moodSettings}

High quality, 8k resolution. ${ratio} --niji 6`.trim();

        document.getElementById('finalPrompt').innerText = final;
    }

    function copyPrompt() {
        navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText);
        const btn = document.querySelector('.copy-tag');
        btn.innerText = "ƒê√É COPY!"; btn.style.background = "#1B5E20";
        setTimeout(() => { btn.innerText = "üìã COPY"; btn.style.background = "#8CCB7A"; }, 2000);
    }
</script>

</body>
</html>

