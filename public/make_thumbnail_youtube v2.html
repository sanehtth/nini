<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√≥m Ng√†n Chuy·ªán Studio - Nini Funny</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="green-theme.css">
</head>
<body>

<header>
    <h1>üé¨ X√≥m Ng√†n Chuy·ªán Studio</h1>
    <div class="subtitle">Tr√¨nh t·∫°o Prompt chu·∫©n Asset (Background & Character)</div>
    <div class="user-info">
        <span>Admin Mode</span>
        <button class="profile-btn">Settings</button>
    </div>
</header>

<div class="container studio-container">
    
    <div id="statusBar" class="alert" style="display:block">
        üîÑ ƒêang k·∫øt n·ªëi t·ªõi kho d·ªØ li·ªáu...
    </div>

    <div class="studio-grid">
        
        <div class="studio-panel">
            
            <div class="input-group">
                <label class="section-label">1. CH·ªåN B·ªêI C·∫¢NH</label>
                <select id="bgSelect" class="studio-input">
                    <option>-- ƒêang t·∫£i... --</option>
                </select>
                <input type="text" id="customBg" class="studio-input" placeholder="Ho·∫∑c nh·∫≠p b·ªëi c·∫£nh t√πy ch·ªânh...">
            </div>

            <div class="input-group">
                <label class="section-label">2. ƒê·ªòI H√åNH NH√ÇN V·∫¨T</label>
                <div id="charList" class="char-list"></div>
                <button class="sub-btn w-100" onclick="addChar()">+ Th√™m nh√¢n v·∫≠t</button>
            </div>

            <div class="input-group">
                <label class="section-label">3. H√ÄNH ƒê·ªòNG / C·ªêT TRUY·ªÜN</label>
                <textarea id="actionInput" class="studio-input" rows="3" placeholder="M√¥ t·∫£: T√πmLa ƒëang l√©n ƒÉn c√° n∆∞·ªõng, m·∫∑t l·∫•m l√©t..."></textarea>
            </div>

            <div class="input-group">
                <label class="section-label">4. C·∫§U H√åNH ·∫¢NH</label>
                <div class="config-row">
                    <select id="styleSelect" class="studio-input">
                        <option value="video">üé¨ Video H√†i (S√°ng/Vui)</option>
                        <option value="podcast">üéôÔ∏è Podcast (T·ªëi/Ma m·ªã)</option>
                    </select>
                    <select id="ratioSelect" class="studio-input">
                        <option value="--ar 16:9">YouTube (16:9)</option>
                        <option value="--ar 9:16">Shorts (9:16)</option>
                        <option value="--ar 1:1">Vu√¥ng (1:1)</option>
                    </select>
                </div>
            </div>

            <button class="main-btn w-100" onclick="generate()">‚ö° T·∫†O PROMPT NGAY</button>
        </div>

        <div class="studio-panel result-panel">
            <label class="section-label">K·∫æT QU·∫¢ PROMPT</label>
            <div class="prompt-card">
                <div id="finalPrompt" class="prompt-content">
                    (K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y...)
                </div>
                <button class="copy-btn-floating" onclick="copyPrompt()">üìã Copy</button>
            </div>
            
            <div class="tips-box">
                <strong>üí° Tips:</strong>
                <ul>
                    <li>Ch·ªçn <strong>Podcast</strong> ƒë·ªÉ c√≥ ·∫£nh t·ªëi, ma m·ªã.</li>
                    <li>Ch·ªçn <strong>Video H√†i</strong> ƒë·ªÉ c√≥ ·∫£nh s√°ng, r·ª±c r·ª°.</li>
                    <li>Th√™m nhi·ªÅu nh√¢n v·∫≠t ƒë·ªÉ ·∫£nh sinh ƒë·ªông h∆°n.</li>
                </ul>
            </div>
        </div>
    </div>

</div>

<script>
    // C·∫§U H√åNH ƒê∆Ø·ªúNG D·∫™N (S·ª≠a l·∫°i cho ƒë√∫ng th∆∞ m·ª•c c·ªßa b·∫°n)
    const DATA_PATH = "adn/xomnganchuyen/"; 
    
    const BG_URL = DATA_PATH + "XNC_backgrounds.json";
    const CHAR_URL = DATA_PATH + "XNC_characters.json";

    let bgData = [], charData = [];

    window.onload = async () => {
        const status = document.getElementById('statusBar');
        try {
            const [bgRes, charRes] = await Promise.all([fetch(BG_URL), fetch(CHAR_URL)]);
            if(!bgRes.ok || !charRes.ok) throw new Error("L·ªói ƒë·ªçc file JSON");

            const bgJson = await bgRes.json();
            const charJson = await charRes.json();

            bgData = bgJson.backgrounds || [];
            charData = charJson.characters || [];

            populateBg();
            addChar();
            
            status.innerHTML = `‚úÖ <strong>S·∫µn s√†ng!</strong> ƒê√£ t·∫£i ${bgData.length} b·ªëi c·∫£nh & ${charData.length} nh√¢n v·∫≠t.`;
            status.style.background = "#dcfce7"; 
            status.style.color = "#15803d";

        } catch (e) {
            console.error(e);
            status.innerHTML = `‚ö†Ô∏è <strong>L·ªói k·∫øt n·ªëi:</strong> Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu t·∫°i '${DATA_PATH}'.`;
        }
    };

    function populateBg() {
        const sel = document.getElementById('bgSelect');
        sel.innerHTML = '<option value="">-- Ch·ªçn b·ªëi c·∫£nh --</option>';
        bgData.forEach(bg => {
            const opt = document.createElement('option');
            opt.value = bg.id;
            opt.dataset.desc = bg.prompt || bg.desc_en || bg.desc || ""; 
            opt.text = bg.label || bg.name || bg.id;
            sel.appendChild(opt);
        });
    }

    function addChar() {
        const div = document.createElement('div');
        div.className = 'char-row-studio';
        let opts = `<option value="">-- Ch·ªçn nh√¢n v·∫≠t --</option>`;
        charData.forEach(c => {
            let desc = c.prompt || c.base_desc_en || c.desc_en || (c.appearance + " " + c.outfit);
            desc = desc ? desc.replace(/"/g, '&quot;') : "";
            opts += `<option value="${c.id}" data-desc="${desc}">${c.name}</option>`;
        });
        div.innerHTML = `
            <select class="studio-input char-sel">${opts}</select>
            <input type="text" class="studio-input char-act" placeholder="H√†nh ƒë·ªông...">
            <button class="remove-btn" onclick="this.parentElement.remove()">√ó</button>
        `;
        document.getElementById('charList').appendChild(div);
    }
//============== cap nhat them style DNA cua xom =====================
   function generate() {
        // 1. L·∫§Y B·ªêI C·∫¢NH
        const bgSel = document.getElementById('bgSelect');
        const customBg = document.getElementById('customBg').value;
        const bgDesc = customBg || bgSel.options[bgSel.selectedIndex]?.dataset.desc || "";
        
        if(!bgDesc) { alert("Ch∆∞a ch·ªçn b·ªëi c·∫£nh!"); return; }

        // 2. L·∫§Y NH√ÇN V·∫¨T (V√≤ng l·∫∑p qua danh s√°ch)
        let chars = [];
        document.querySelectorAll('.char-row-studio').forEach(row => {
            const sel = row.querySelector('.char-sel');
            const act = row.querySelector('.char-act').value;
            if(sel.value) {
                const name = sel.options[sel.selectedIndex].text;
                const desc = sel.options[sel.selectedIndex].dataset.desc;
                chars.push(`CHARACTER (${name}): ${desc}. ACTION: ${act || "standing"}`);
            }
        });

        // 3. L·∫§Y C·∫§U H√åNH INPUT
        const action = document.getElementById('actionInput').value;
        const style = document.getElementById('styleSelect').value;
        const ratio = document.getElementById('ratioSelect').value;

        // --- C·∫¨P NH·∫¨T: TH√äM DNA M√ÄU S·∫ÆC C·ª¶A X√ìM ---
        // ƒê·ªãnh nghƒ©a b·∫£ng m√†u chu·∫©n t·ª´ file style.json c·ªßa b·∫°n
        const brandDNA = "**BRAND PALETTE:** Primary Green (#8CCB7A), Earthy Brown (#B9885D), Accent Yellow (#F4E8A2). Soft Pastel Tones (#CDECC1, #D8BFA8).";

        // --- C·∫¨P NH·∫¨T: MOOD & LIGHTING D·ª∞A TR√äN STYLE ---
        let moodSettings = "";
        
        if (style === 'podcast') {
            // Podcast: T·ªëi, Ma m·ªã nh∆∞ng v·∫´n gi·ªØ ch·∫•t X√≥m (D√πng m√†u N√¢u + V√†ng l√†m ƒëi·ªÉm s√°ng trong ƒë√™m)
            moodSettings = `**MOOD & ATMOSPHERE:** Mysterious, Spooky but cozy, Storytelling vibe.
**LIGHTING & COLOR:** Dim lighting, Vignette effect. Dark Night Blue atmosphere mixed with Warm Brown (#B9885D) shadows and soft Yellow (#F4E8A2) highlights (lantern/moon/candle).
**VISUALS:** Microphone icon in corner (optional).`;
        } else {
            // Video H√†i: S√°ng, R·ª±c r·ª° (D√πng m√†u Xanh + V√†ng l√†m ch·ªß ƒë·∫°o)
            moodSettings = `**MOOD & ATMOSPHERE:** Bright, Energetic, Funny, High Contrast, Cartoon motion lines.
**LIGHTING & COLOR:** Sunny daylight. Dominant Fresh Green (#8CCB7A) and bright Sunny Yellow (#F4E8A2). Vibrant and colorful.`;
        }

        // 4. T·∫†O PROMPT CU·ªêI C√ôNG
        const final = `
(YouTube Thumbnail), 2D animation style, Vietnamese countryside aesthetic, pastel chibi art.
${brandDNA}

**BACKGROUND:** ${bgDesc}
**CHARACTERS:**
${chars.join("\n")}
**SCENE EVENT:** ${action}

${moodSettings}

High quality, 8k resolution, detailed art. ${ratio} --niji 6
        `.trim();

        // 5. HI·ªÇN TH·ªä K·∫æT QU·∫¢
        document.getElementById('finalPrompt').innerText = final;
    }
//==========het ham cap nhat DNA=====================
    function copyPrompt() {
        navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText);
        const btn = document.querySelector('.copy-btn-floating');
        btn.innerText = "ƒê√£ Copy!";
        btn.style.background = "#15803d";
        setTimeout(() => { btn.innerText = "üìã Copy"; btn.style.background = "#e11d48"; }, 2000);
    }
</script>

</body>
</html>

