<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√≥m Ng√†n Chuy·ªán Studio V6 - Local Path</title>
    <style>
        :root { --primary: #FFD700; --bg: #121212; --panel: #1e1e1e; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--panel); padding: 30px; border-radius: 12px; border: 1px solid #333; }
        h1 { text-align: center; color: var(--primary); margin-top: 0; }
        .status-bar { text-align: center; font-size: 0.9em; margin-bottom: 20px; padding: 10px; background: #252525; border-radius: 6px; }
        
        /* FORM ELEMENTS */
        .section-header { color: #fff; font-weight: bold; margin: 20px 0 10px; border-left: 3px solid var(--primary); padding-left: 10px; }
        select, input, textarea { width: 100%; padding: 12px; background: #2a2a2a; border: 1px solid #444; color: #fff; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
        select:focus, input:focus, textarea:focus { border-color: var(--primary); outline: none; }
        
        /* CHARACTERS */
        .char-row { display: grid; grid-template-columns: 2fr 1fr auto; gap: 10px; margin-bottom: 10px; }
        .btn-add { width: 100%; padding: 10px; background: #333; color: var(--primary); border: 1px dashed var(--primary); cursor: pointer; border-radius: 6px; }
        .btn-remove { background: #ff4444; color: white; border: none; width: 30px; border-radius: 4px; cursor: pointer; }

        /* BUTTONS */
        .btn-gen { width: 100%; padding: 15px; background: linear-gradient(135deg, #FFD700, #FFA500); color: black; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin-top: 20px; }
        .btn-gen:hover { transform: translateY(-2px); }

        /* RESULT */
        #resultArea { margin-top: 30px; display: none; }
        .prompt-box { background: #111; padding: 15px; border-radius: 6px; border: 1px solid #444; color: #a5d6a7; font-family: monospace; white-space: pre-wrap; position: relative; }
        .copy-btn { position: absolute; top: 10px; right: 10px; background: #333; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üé¨ X√≥m Ng√†n Chuy·ªán Studio V6</h1>
    
    <div id="statusBar" class="status-bar">
        üîÑ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ server...
    </div>

    <div class="section-header">1. CH·ªåN B·ªêI C·∫¢NH</div>
    <select id="bgSelect"><option>-- ƒêang t·∫£i... --</option></select>
    <input type="text" id="customBg" placeholder="Ho·∫∑c nh·∫≠p b·ªëi c·∫£nh t√πy ch·ªânh...">

    <div class="section-header">2. CH·ªåN NH√ÇN V·∫¨T</div>
    <div id="charList"></div>
    <button class="btn-add" onclick="addChar()">+ Th√™m nh√¢n v·∫≠t</button>

    <div class="section-header">3. C·ªêT TRUY·ªÜN / H√ÄNH ƒê·ªòNG</div>
    <textarea id="actionInput" rows="3" placeholder="M√¥ t·∫£: T√πmLa ƒëang l√©n ƒÉn c√° n∆∞·ªõng, m·∫∑t l·∫•m l√©t..."></textarea>

    <div class="section-header">4. C·∫§U H√åNH</div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <select id="styleSelect">
            <option value="video">üé¨ Video H√†i (S√°ng/Vui)</option>
            <option value="podcast">üéôÔ∏è Podcast (T·ªëi/Ma m·ªã)</option>
        </select>
        <select id="ratioSelect">
            <option value="--ar 16:9">YouTube Ngang (16:9)</option>
            <option value="--ar 9:16">Shorts D·ªçc (9:16)</option>
            <option value="--ar 1:1">Vu√¥ng (1:1)</option>
        </select>
    </div>

    <button class="btn-gen" onclick="generate()">‚ö° T·∫†O PROMPT</button>

    <div id="resultArea">
        <div class="section-header">K·∫æT QU·∫¢:</div>
        <div class="prompt-box">
            <div id="finalPrompt"></div>
            <button class="copy-btn" onclick="copyPrompt()">COPY</button>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // C·∫§U H√åNH ƒê∆Ø·ªúNG D·∫™N (QUAN TR·ªåNG)
    // D·ª±a v√†o ·∫£nh b·∫°n g·ª≠i, file JSON n·∫±m trong folder "adn/xomnganchuyen/"
    // N·∫øu b·∫°n ƒë·∫∑t file HTML n√†y C√ôNG CH·ªñ v·ªõi file JSON, h√£y s·ª≠a d√≤ng d∆∞·ªõi th√†nh: "./"
    
    const DATA_PATH = "adn/xomnganchuyen/"; 
    
    // ============================================================

    const BG_URL = DATA_PATH + "XNC_backgrounds.json";
    const CHAR_URL = DATA_PATH + "XNC_characters.json";

    let bgData = [];
    let charData = [];

    window.onload = async () => {
        const status = document.getElementById('statusBar');
        try {
            // Th·ª≠ load file
            const [bgRes, charRes] = await Promise.all([fetch(BG_URL), fetch(CHAR_URL)]);
            
            if(!bgRes.ok || !charRes.ok) {
                // N·∫øu l·ªói, th·ª≠ load ki·ªÉu c√πng th∆∞ m·ª•c (ph√≤ng h·ªù b·∫°n di chuy·ªÉn file)
                throw new Error("Kh√¥ng t√¨m th·∫•y file ·ªü ƒë∆∞·ªùng d·∫´n: " + DATA_PATH);
            }

            const bgJson = await bgRes.json();
            const charJson = await charRes.json();

            bgData = bgJson.backgrounds || [];
            charData = charJson.characters || [];

            populateBg();
            addChar();
            
            status.innerHTML = `‚úÖ <strong>ƒê√£ k·∫øt n·ªëi!</strong> T√¨m th·∫•y ${bgData.length} b·ªëi c·∫£nh v√† ${charData.length} nh√¢n v·∫≠t.`;
            status.style.color = "#4CAF50";
            status.style.border = "1px solid #4CAF50";

        } catch (e) {
            console.error(e);
            status.innerHTML = `‚ö†Ô∏è <strong>L·ªói:</strong> Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c file JSON.<br>H√£y ƒë·∫£m b·∫£o file HTML v√† th∆∞ m·ª•c 'adn' n·∫±m ƒë√∫ng v·ªã tr√≠.<br>(${e.message})`;
            status.style.color = "#FF4444";
        }
    };

    function populateBg() {
        const sel = document.getElementById('bgSelect');
        sel.innerHTML = '<option value="">-- Ch·ªçn b·ªëi c·∫£nh c√≥ s·∫µn --</option>';
        bgData.forEach(bg => {
            const opt = document.createElement('option');
            opt.value = bg.id;
            opt.dataset.desc = bg.prompt || bg.desc_en || bg.desc || ""; 
            opt.text = bg.label || bg.name || bg.id;
            sel.appendChild(opt);
        });
    }

    function addChar() {
        const div = document.createElement('div');
        div.className = 'char-row';
        let opts = `<option value="">-- Ch·ªçn nh√¢n v·∫≠t --</option>`;
        charData.forEach(c => {
            let desc = c.prompt || c.base_desc_en || c.desc_en || (c.appearance + " " + c.outfit);
            desc = desc ? desc.replace(/"/g, '&quot;') : "";
            opts += `<option value="${c.id}" data-desc="${desc}">${c.name}</option>`;
        });
        div.innerHTML = `
            <select class="char-sel">${opts}</select>
            <input type="text" class="char-act" placeholder="H√†nh ƒë·ªông (Vd: c∆∞·ªùi, s·ª£ h√£i)...">
            <button class="btn-remove" onclick="this.parentElement.remove()">√ó</button>
        `;
        document.getElementById('charList').appendChild(div);
    }

    function generate() {
        const bgSel = document.getElementById('bgSelect');
        const customBg = document.getElementById('customBg').value;
        const bgDesc = customBg || bgSel.options[bgSel.selectedIndex]?.dataset.desc || "";
        
        if(!bgDesc) { alert("Ch∆∞a ch·ªçn b·ªëi c·∫£nh!"); return; }

        let chars = [];
        document.querySelectorAll('.char-row').forEach(row => {
            const sel = row.querySelector('.char-sel');
            const act = row.querySelector('.char-act').value;
            if(sel.value) {
                const name = sel.options[sel.selectedIndex].text;
                const desc = sel.options[sel.selectedIndex].dataset.desc;
                chars.push(`CHARACTER (${name}): ${desc}. ACTION: ${act || "standing"}`);
            }
        });

        const action = document.getElementById('actionInput').value;
        const style = document.getElementById('styleSelect').value;
        const ratio = document.getElementById('ratioSelect').value;

        let mood = style === 'podcast' 
            ? "**MOOD:** Mysterious, Spooky, Dim Lighting, Storytelling vibe. Visuals: Vignette, Microphone icon, Dark Blue/Purple tones."
            : "**MOOD:** Bright, Energetic, Funny, High Contrast, Cartoon motion lines.";

        const final = `
(YouTube Thumbnail), 2D animation style, Vietnamese countryside aesthetic, pastel chibi art.
**BACKGROUND:** ${bgDesc}
**CHARACTERS:**
${chars.join("\n")}
**SCENE EVENT:** ${action}
${mood}
High quality, 8k resolution. ${ratio} --niji 6
        `.trim();

        document.getElementById('finalPrompt').innerText = final;
        document.getElementById('resultArea').style.display = 'block';
    }

    function copyPrompt() {
        navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText);
        alert("ƒê√£ copy Prompt!");
    }
</script>

</body>
</html>
